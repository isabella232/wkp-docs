(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{147:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return i})),n.d(t,"default",(function(){return o}));var r=n(3),a=n(7),l=(n(0),n(217)),s={title:"Templates"},c={unversionedId:"mccp/cli-templates",id:"mccp/cli-templates",isDocsHomePage:!1,title:"Templates",description:"Introduction",source:"@site/docs/mccp/cli-templates.md",slug:"/mccp/cli-templates",permalink:"/docs/next/mccp/cli-templates",editUrl:"https://github.com/weaveworks/wkp-docs/tree/main/docs/mccp/cli-templates.md",version:"current",sidebar:"mccp",previous:{title:"CAPI Provider Identities",permalink:"/docs/next/mccp/provider-identities"},next:{title:"Clusters",permalink:"/docs/next/mccp/cli-clusters"}},i=[{value:"Introduction",id:"introduction",children:[]},{value:"Listing templates",id:"listing-templates",children:[]},{value:"Listing template parameters",id:"listing-template-parameters",children:[]},{value:"Rendering a template with parameters",id:"rendering-a-template-with-parameters",children:[]},{value:"Creating a pull request",id:"creating-a-pull-request",children:[]},{value:"Listing template infrastructure credentials",id:"listing-template-infrastructure-credentials",children:[]}],p={toc:i};function o(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(l.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(l.b)("h3",{id:"introduction"},"Introduction"),Object(l.b)("p",null,"The MCCP CLI allows listing and rendering of ",Object(l.b)("inlineCode",{parentName:"p"},"CAPITemplate")," resources, viewing\nof template parameters, viewing of infrastructure credentials and submission of\npull requests for creating Kubernetes clusters using the terminal. Currently,\nthe CAPA (AWS) and CAPD (Docker) providers are supported."),Object(l.b)("h3",{id:"listing-templates"},"Listing templates"),Object(l.b)("p",null,"To get a list of ",Object(l.b)("inlineCode",{parentName:"p"},"CAPITemplate")," resources run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mccp templates list\n")),Object(l.b)("p",null,"This command returns a list of all available ",Object(l.b)("inlineCode",{parentName:"p"},"CAPITemplate")," resources that have\nbeen added previously to the management cluster. In the following example, only\na single ",Object(l.b)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/cluster-api-provider-aws/blob/b6494f993242d7849cd538177ccd74a7a60de1d9/templates/cluster-template-eks-fargate.yaml"},"template")," is returned named ",Object(l.b)("inlineCode",{parentName:"p"},"cluster-template-eks-fargate"),"."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"NAME                            DESCRIPTION\ncluster-template-eks-fargate    This is an AWS cluster template for EKS Fargate\n")),Object(l.b)("h3",{id:"listing-template-parameters"},"Listing template parameters"),Object(l.b)("p",null,"To get a list of parameters for a given ",Object(l.b)("inlineCode",{parentName:"p"},"CAPITemplate")," run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mccp templates render cluster-template-eks-fargate --list-parameters\n")),Object(l.b)("p",null,"This command returns a list of all template parameters for a given template.\nThese parameters need to be set in order to render a template or create a pull\nrequest for a new CAPI cluster. In the following example, four template\nparameters are shown."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"NAME                DESCRIPTION\nAWS_REGION          The AWS region to deploy the cluster to.\nAWS_SSH_KEY_NAME    The AWS SSH key name.\nCLUSTER_NAME        The name of the cluster.\nKUBERNETES_VERSION  The version of Kubernetes to deploy.\n")),Object(l.b)("h3",{id:"rendering-a-template-with-parameters"},"Rendering a template with parameters"),Object(l.b)("p",null,"To set the parameters for a template and render it run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mccp templates render cluster-template-eks-fargate \\\n    --set=CLUSTER_NAME=dev \\\n    --set=AWS_REGION=us-east-1 \\\n    --set=AWS_SSH_KEY_NAME=ssh_key \\\n    --set=KUBERNETES_VERSION=1.19\n")),Object(l.b)("p",null,"This command uses the parameters supplied to output the CAPI manifest to the\nterminal."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},'apiVersion: cluster.x-k8s.io/v1alpha4\nkind: Cluster\nmetadata:\n  name: dev\nspec:\n  clusterNetwork:\n    pods:\n      cidrBlocks:\n      - 192.168.0.0/16\n  controlPlaneRef:\n    apiVersion: controlplane.cluster.x-k8s.io/v1alpha4\n    kind: AWSManagedControlPlane\n    name: dev-control-plane\n  infrastructureRef:\n    apiVersion: infrastructure.cluster.x-k8s.io/v1alpha4\n    kind: AWSManagedCluster\n    name: dev\n\n---\napiVersion: infrastructure.cluster.x-k8s.io/v1alpha4\nkind: AWSManagedCluster\nmetadata:\n  name: dev\n\n---\napiVersion: controlplane.cluster.x-k8s.io/v1alpha4\nkind: AWSManagedControlPlane\nmetadata:\n  name: dev-control-plane\nspec:\n  region: us-east-1\n  sshKeyName: ssh_key\n  version: "1.19"\n\n---\napiVersion: infrastructure.cluster.x-k8s.io/v1alpha4\nkind: AWSFargateProfile\nmetadata:\n  name: dev-fargate-0\nspec:\n  clusterName: mb-test-1\n  selectors:\n  - namespace: default\n')),Object(l.b)("h3",{id:"creating-a-pull-request"},"Creating a pull request"),Object(l.b)("p",null,"To create a pull request for a new Kubernetes cluster using a template run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},'mccp templates render cluster-template-eks-fargate \\\n    --set=CLUSTER_NAME=dev \\\n    --set=AWS_REGION=us-east-1 \\\n    --set=AWS_SSH_KEY_NAME=ssh_key \\\n    --set=KUBERNETES_VERSION=1.19\n    --create-pr \\\n    --pr-branch=new-dev-cluster \\\n    --pr-commit-message="Add new template" \\\n    --pr-title="New dev cluster" \\\n    --pr-description="Create a new dev cluster"\n')),Object(l.b)("p",null,"This command returns a message that includes the URL for the new pull request."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"Created pull request: https://github.com/weaveworks/mccp-demo/pull/1\n")),Object(l.b)("h3",{id:"listing-template-infrastructure-credentials"},"Listing template infrastructure credentials"),Object(l.b)("p",null,"To get a list of infrastructure credentials for a given ",Object(l.b)("inlineCode",{parentName:"p"},"CAPITemplate")," run:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mccp templates render cluster-template-eks-fargate --list-credentials\n")),Object(l.b)("p",null,"This command returns the list of all infrastructure credentials."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"NAME\ndefault-account\n")))}o.isMDXComponent=!0},217:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return b}));var r=n(0),a=n.n(r);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),o=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=o(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=o(n),d=r,b=u["".concat(s,".").concat(d)]||u[d]||m[d]||l;return n?a.a.createElement(b,c(c({ref:t},p),{},{components:n})):a.a.createElement(b,c({ref:t},p))}));function b(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,s=new Array(l);s[0]=d;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:r,s[1]=c;for(var p=2;p<l;p++)s[p]=n[p];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);