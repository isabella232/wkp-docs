<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="WKP Technical Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="WKP Technical Documentation Blog Atom Feed"><title data-react-helmet="true">Installation | WKP Technical Documentation</title><meta data-react-helmet="true" property="og:url" content="https://weaveworks.github.io/wkp-docs//docs/next/mccp/installation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Installation | WKP Technical Documentation"><meta data-react-helmet="true" name="description" content="How to: Install MCCP using a Helm chart"><meta data-react-helmet="true" property="og:description" content="How to: Install MCCP using a Helm chart"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon_150px.png"><link data-react-helmet="true" rel="canonical" href="https://weaveworks.github.io/wkp-docs//docs/next/mccp/installation"><link data-react-helmet="true" rel="alternate" href="https://weaveworks.github.io/wkp-docs//docs/next/mccp/installation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://weaveworks.github.io/wkp-docs//docs/next/mccp/installation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.68a53ba0.css">
<link rel="preload" href="/assets/js/styles.9b51c504.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.784a2059.js" as="script">
<link rel="preload" href="/assets/js/main.f56fc61d.js" as="script">
<link rel="preload" href="/assets/js/1.8f64b48f.js" as="script">
<link rel="preload" href="/assets/js/2.eb8cc18f.js" as="script">
<link rel="preload" href="/assets/js/3.cd3778c7.js" as="script">
<link rel="preload" href="/assets/js/1be78505.ef2c6553.js" as="script">
<link rel="preload" href="/assets/js/148.2a99a6b4.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.0189a7ca.js" as="script">
<link rel="preload" href="/assets/js/17896441.54228d72.js" as="script">
<link rel="preload" href="/assets/js/4307eb85.5983e330.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/weave-logo.png" alt="WKP docs" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/weave-logo.png" alt="WKP docs" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">WKP Docs</strong></a><a class="navbar__item navbar__link" href="/docs/next/">WKP</a><a class="navbar__item navbar__link navbar__link--active" href="/docs/next/mccp/intro">Multi-Cluster Control Plane</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/next/download">WKP Downloads</a><a class="navbar__item navbar__link" href="/docs/next/release-notes">Release Notes</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__item navbar__link" href="/docs/next/">main</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/next/mccp/installation">main</a></li><li><a class="dropdown__link" href="/docs/">2.5.0</a></li><li><a class="dropdown__link" href="/docs/2.4.2/">2.4.2</a></li></ul></div><a href="https://github.com/weaveworks/wkp-docs/tree/main" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/weave-logo.png" alt="WKP docs" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/weave-logo.png" alt="WKP docs" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">WKP Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/">WKP</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/next/mccp/intro">Multi-Cluster Control Plane</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/next/download">WKP Downloads</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/next/release-notes">Release Notes</a></li><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/next/mccp/installation">main</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/">2.5.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/2.4.2/">2.4.2</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/weaveworks/wkp-docs/tree/main" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/next/mccp/intro">Introduction</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/next/mccp/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">Usage Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/existing-clusters">Existing clusters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/cluster-api-providers">Cluster API Providers</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/templates">CAPI Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/provider-identities">CAPI Provider Identities</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/deleting-a-cluster">Deleting a Cluster</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist" href="#!">MCCP CLI Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/cli-templates">Templates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/next/mccp/cli-clusters">Clusters</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for WKP Technical Documentation <strong>main</strong> version.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/">latest version</a></strong> (2.5.0).</div></div><div class="docItemContainer_33ec"><article><div><span class="badge badge--secondary">Version: main</span></div><header><h1 class="docTitle_3a4h">Installation</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-install-mccp-using-a-helm-chart"></a>How to: Install MCCP using a Helm chart<a class="hash-link" href="#how-to-install-mccp-using-a-helm-chart" title="Direct link to heading">#</a></h2><p>Installing MCCP requires we:</p><ol><li>Create a namespace</li><li>Choose a database</li><li>Create a secret for docker repository</li><li>Create a secret for creating pull requests on your git provider</li><li>Determine the public IP address of the worker nodes</li><li>Install the MCCP helm chart</li><li>Check that MCCP has been installed (optional)</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-creating-a-namespace"></a>1. Creating a namespace<a class="hash-link" href="#1-creating-a-namespace" title="Direct link to heading">#</a></h3><p>Create a new namespace that will be used to run the MCCP components:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create namespace mccp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-choosing-a-database"></a>2. Choosing a database<a class="hash-link" href="#2-choosing-a-database" title="Direct link to heading">#</a></h3><p>MCCP stores incoming data from the connected clusters to a relational database. It supports <strong>SQLite</strong> and <strong>PostgreSQL</strong>. When using <strong>SQLite</strong> the database file may be stored on a host path volume or on a persistent volume. By default, MCCP will use <strong>SQLite on a host path volume</strong>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>Installing MCCP in its default configuration is ideal for trying it out but it is not recommended for production use. Using a SQLite database on a persistent volume or a cloud-hosted PostgreSQL database allows for increased reliability and scalability.</p></div></div><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SQLite on a host path volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">SQLite on a persistent volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">PostgreSQL</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>In this configuration, the database file is stored on one of the cluster worker nodes. In order for all the MCCP pods to be able to access the host volume, they must be placed on the same node. We can enforce this by applying a label to one of the cluster worker nodes:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># list all worker nodes</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get node --selector</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;!node-role.kubernetes.io/master&#x27;</span><span class="token plain"> -o name</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">node/ip-192-168-40-197.eu-north-1.compute.internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">node/ip-192-168-68-212.eu-north-1.compute.internal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># choose the first one and label it for mccp database hosting</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl label node/ip-192-168-40-197.eu-north-1.compute.internal wkp-database-volume-node</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">true</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This label will ensure that the MCCP pods will be deployed and run on the selected node.</p></div><div role="tabpanel" hidden=""><p>If your cluster supports persistent volume storage and has a storage class defined, you can use it to request a persistent volume for the SQLite database file. The exact details of the persistent volume request vary by cluster type and the supported volume types. The following manifest is an example of a configuration of a <code>PersistentVolumeClaim</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><div tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> PersistentVolumeClaim</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> mccp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">volume</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">namespace</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> mccp</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">storageClassName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">resources</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">requests</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">storage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 100G</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumeMode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Filesystem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">accessModes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ReadWriteOnce</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><div role="tabpanel" hidden=""><p>Using a PostgreSQL database does not require any additional setup on the cluster side. The following details are however needed in order to connect:</p><ul><li>Database server hostname</li><li>Database name</li><li>Database user - The database user requires admin privileges on the database server as it will automatically create the necessary schema.</li><li>Database password</li></ul><p>The database credentials (user and password) need to be provided separately, before
installing the chart, as a secret. Run the following command to create a secret:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create secret generic mccp-db-credentials </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">username</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">database-user</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">password</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">database-password</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-creating-a-secret-for-docker-repository"></a>3. Creating a secret for docker repository<a class="hash-link" href="#3-creating-a-secret-for-docker-repository" title="Direct link to heading">#</a></h3><p>Create a secret that contains your docker repository credentials. This secret will be used by Kubernetes during deployment in order to pull down the MCCP images. You can find instructions on how to generate this secret <a href="https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Add this secret to the target namespace. This needs to be the same namespace that the Helm chart will be installed.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl create secret docker-registry </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace mccp docker-io-pull-secret </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --docker-username</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your-docker-username</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --docker-password</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">your-docker-password</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>If you use a secrets management solution such as Sealed Secrets follow their instructions on how to create a new secret.</p><p>Take note of the secret name as you will need to supply it later when installing the chart.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-create-a-secret-for-creating-pull-requests-on-your-git-provider"></a>4. Create a secret for creating pull requests on your git provider<a class="hash-link" href="#4-create-a-secret-for-creating-pull-requests-on-your-git-provider" title="Direct link to heading">#</a></h3><p>A Personal Access Token is required for the MCCP to create pull requests for new clusters. These tokens need certain permissions (scopes) set. For</p><ul><li>GitHub: <code>repo</code></li><li>GitLab: <code>api</code></li></ul><p>Save the token in secret called <code>git-provider-credentials</code> in the mccp&#x27;s deployment namespace:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl create secret generic git-provider-credentials </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">mccp-namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  --from-literal</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GIT_PROVIDER_TOKEN=</span><span class="token string variable" style="color:rgb(191, 199, 213)">$GITHUB_TOKEN</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-determining-the-public-ip-address-of-the-worker-nodes"></a>5. Determining the public IP address of the worker nodes<a class="hash-link" href="#5-determining-the-public-ip-address-of-the-worker-nodes" title="Direct link to heading">#</a></h3><p>You need to determine the public IP address of the worker nodes of your cluster. This IP address is necessary in order to establish connectivity between agents and your MCCP instance. The way to determine this depends on your cluster type and provisioning method. Take note of that IP address as you will need to supply it later when installing the chart.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p><em>You may also use a domain name instead of an IP address.</em></p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-installing-the-helm-chart"></a>6. Installing the Helm chart<a class="hash-link" href="#6-installing-the-helm-chart" title="Direct link to heading">#</a></h3><p>Before installing the chart, you need to add the Helm chart repository and then update its local cache. Run the following commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm repo </span><span class="token function" style="color:rgb(130, 170, 255)">add</span><span class="token plain"> wkpv3 https://s3.us-east-1.amazonaws.com/weaveworks-wkp/charts-v3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkpv3&quot;</span><span class="token plain"> has been added to your repositories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm repo update</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Hang tight </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> we grab the latest from your chart repositories</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.Successfully got an update from the </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkpv3&quot;</span><span class="token plain"> chart repository</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Update Complete. âŽˆHappy Helming</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">âŽˆ</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Finally install the Helm chart to the target namespace by executing the following command using the Helm CLI (&gt;= <code>v3.5.4</code>).</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">SQLite on a host path volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">SQLite on a persistent volume</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">PostgreSQL</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> mccp wkpv3/mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --version </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">chart-version</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;imagePullSecrets[0].name=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;agentTemplate.natsURL=&lt;nats-address&gt;:&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nats.client.service.nodePort=&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkp-ui.image.pullSecrets[0]=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.repositoryURL=https://github.com/example/management-repo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.baseBranch=main&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> mccp wkpv3/mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --version </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">chart-version</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;imagePullSecrets[0].name=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseType=sqlite&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sqliteConfig.persistentVolumeClaim=true&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;agentTemplate.natsURL=&lt;nats-address&gt;:&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nats.client.service.nodePort=&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkp-ui.image.pullSecrets[0]=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.repositoryURL=https://github.com/example/management-repo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.baseBranch=main&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ helm </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> mccp wkpv3/mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --version </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">chart-version</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --namespace mccp </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;imagePullSecrets[0].name=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseType=postgres&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;dbConfig.databaseURI=&lt;database-server-hostname&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;postgresConfig.databaseName=&lt;database-name&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;agentTemplate.natsURL=&lt;nats-address&gt;:&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nats.client.service.nodePort=&lt;exposed-port-for-nats&gt;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;wkp-ui.image.pullSecrets[0]=&lt;secret-containing-docker-config&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.repositoryURL=https://github.com/example/management-repo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    --set </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;config.capi.baseBranch=main&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By default, connections to PostgreSQL will use port 5432.</p></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="7-checking-that-mccp-is-installed-optional"></a>7. Checking that MCCP is installed (optional)<a class="hash-link" href="#7-checking-that-mccp-is-installed-optional" title="Direct link to heading">#</a></h3><p>You should now be able to load the MCCP UI by running the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl port-forward --namespace mccp deployments.apps/mccp-nginx-ingress-controller </span><span class="token number" style="color:rgb(247, 140, 108)">8000</span><span class="token plain">:80</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The MCCP UI should now be accessible at <code>http://localhost:8000</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="how-to-install-the-mccp-cli"></a>How to: Install the MCCP CLI<a class="hash-link" href="#how-to-install-the-mccp-cli" title="Direct link to heading">#</a></h2><p>The MCCP CLI allows you to interact with MCCP clusters. You can use <code>mccp</code> to manage the lifecycle of your infrastructure declaratively using GitOps. The latest version of the MCCP CLI is available in the following links:</p><ul><li><a href="https://weaveworks-wkp.s3.amazonaws.com/mccp-master-linux-amd64" target="_blank" rel="noopener noreferrer">Linux</a></li><li><a href="https://weaveworks-wkp.s3.amazonaws.com/mccp-master-darwin-amd64" target="_blank" rel="noopener noreferrer">macOS</a></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/weaveworks/wkp-docs/tree/main/docs/mccp/installation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/next/mccp/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/next/mccp/existing-clusters"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Existing clusters Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-to-install-mccp-using-a-helm-chart" class="table-of-contents__link">How to: Install MCCP using a Helm chart</a><ul><li><a href="#1-creating-a-namespace" class="table-of-contents__link">1. Creating a namespace</a></li><li><a href="#2-choosing-a-database" class="table-of-contents__link">2. Choosing a database</a></li><li><a href="#3-creating-a-secret-for-docker-repository" class="table-of-contents__link">3. Creating a secret for docker repository</a></li><li><a href="#4-create-a-secret-for-creating-pull-requests-on-your-git-provider" class="table-of-contents__link">4. Create a secret for creating pull requests on your git provider</a></li><li><a href="#5-determining-the-public-ip-address-of-the-worker-nodes" class="table-of-contents__link">5. Determining the public IP address of the worker nodes</a></li><li><a href="#6-installing-the-helm-chart" class="table-of-contents__link">6. Installing the Helm chart</a></li><li><a href="#7-checking-that-mccp-is-installed-optional" class="table-of-contents__link">7. Checking that MCCP is installed (optional)</a></li></ul></li><li><a href="#how-to-install-the-mccp-cli" class="table-of-contents__link">How to: Install the MCCP CLI</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Support</h4><ul class="footer__items"><li class="footer__item"><a href="mailto:support@weave.works" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contact Us</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Weaveworks</div></div></div></footer></div>
<script src="/assets/js/styles.9b51c504.js"></script>
<script src="/assets/js/runtime~main.784a2059.js"></script>
<script src="/assets/js/main.f56fc61d.js"></script>
<script src="/assets/js/1.8f64b48f.js"></script>
<script src="/assets/js/2.eb8cc18f.js"></script>
<script src="/assets/js/3.cd3778c7.js"></script>
<script src="/assets/js/1be78505.ef2c6553.js"></script>
<script src="/assets/js/148.2a99a6b4.js"></script>
<script src="/assets/js/935f2afb.0189a7ca.js"></script>
<script src="/assets/js/17896441.54228d72.js"></script>
<script src="/assets/js/4307eb85.5983e330.js"></script>
</body>
</html>